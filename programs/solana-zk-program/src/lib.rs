use anchor_lang::prelude::*;
use groth16_solana::groth16::{Groth16Verifier, Groth16Verifyingkey};

declare_id!("3qpBrBRTWCSKZHqUYgfNsGDgM8DDqk6TEniq8w6EyjJB");

#[program]
pub mod solana_zk_program {
    use super::*;

    pub fn zk_verify(ctx: Context<ZKProof>, args: ZKProofArgs) -> Result<()> {
        ZKProof::verify(ctx, args)
    }
}

const NR_PUBLIC_INPUTS: usize = 1;

#[derive(AnchorSerialize, AnchorDeserialize)]
pub struct ZKProofArgs {
    pub proof_a: [u8; 64],
    pub proof_b: [u8; 128],
    pub proof_c: [u8; 64],
    pub public_inputs: [[u8; 32]; NR_PUBLIC_INPUTS],
}

#[derive(Accounts)]
#[instruction(args: ZKProofArgs)]
pub struct ZKProof {}

impl ZKProof {
    pub fn verify(ctx: Context<Self>, args: ZKProofArgs) -> Result<()> {
        msg!("verify");

        let mut verifier = Groth16Verifier::new(
            &args.proof_a,
            &args.proof_b,
            &args.proof_c,
            &args.public_inputs,
            &VERIFYING_KEY,
        )
        .map_err(|_| ProgramError::Custom(0))?; // Use a custom error code

        let result = verifier.verify();
        match result {
            Ok(true) => msg!("Verification succeeded"),
            Ok(false) => msg!("Verification failed"),
            Err(e) => msg!("Verification error: {:?}", e),
        }
        Ok(())
    }
}

pub const VERIFYING_KEY: Groth16Verifyingkey = Groth16Verifyingkey {
    nr_pubinputs: 2,

    vk_alpha_g1: [
        46, 198, 28, 80, 85, 219, 64, 95, 16, 86, 37, 55, 105, 174, 107, 82, 67, 212, 66, 53, 189,
        244, 65, 129, 153, 249, 14, 192, 208, 23, 189, 255, 46, 213, 140, 248, 251, 76, 224, 235,
        78, 79, 47, 37, 11, 253, 131, 73, 220, 6, 86, 57, 31, 37, 150, 116, 245, 62, 83, 76, 46,
        234, 4, 132,
    ],

    vk_beta_g2: [
        40, 239, 114, 219, 169, 186, 198, 208, 56, 242, 155, 131, 18, 151, 60, 17, 8, 209, 95, 232,
        155, 207, 165, 191, 9, 240, 203, 222, 208, 254, 251, 118, 23, 244, 194, 167, 148, 204, 162,
        27, 134, 119, 235, 184, 191, 212, 15, 40, 60, 80, 108, 153, 207, 223, 171, 38, 222, 36,
        166, 12, 84, 109, 176, 64, 14, 48, 121, 113, 255, 10, 248, 201, 22, 70, 211, 61, 239, 180,
        243, 240, 193, 117, 248, 132, 92, 108, 103, 68, 96, 104, 143, 249, 30, 26, 84, 65, 6, 82,
        118, 185, 31, 130, 171, 49, 7, 175, 0, 68, 128, 209, 81, 253, 68, 111, 106, 183, 12, 127,
        60, 70, 105, 211, 9, 21, 170, 72, 70, 58,
    ],

    vk_gamme_g2: [
        25, 142, 147, 147, 146, 13, 72, 58, 114, 96, 191, 183, 49, 251, 93, 37, 241, 170, 73, 51,
        53, 169, 231, 18, 151, 228, 133, 183, 174, 243, 18, 194, 24, 0, 222, 239, 18, 31, 30, 118,
        66, 106, 0, 102, 94, 92, 68, 121, 103, 67, 34, 212, 247, 94, 218, 221, 70, 222, 189, 92,
        217, 146, 246, 237, 9, 6, 137, 208, 88, 95, 240, 117, 236, 158, 153, 173, 105, 12, 51, 149,
        188, 75, 49, 51, 112, 179, 142, 243, 85, 172, 218, 220, 209, 34, 151, 91, 18, 200, 94, 165,
        219, 140, 109, 235, 74, 171, 113, 128, 141, 203, 64, 143, 227, 209, 231, 105, 12, 67, 211,
        123, 76, 230, 204, 1, 102, 250, 125, 170,
    ],

    vk_delta_g2: [
        24, 192, 59, 38, 123, 253, 143, 209, 31, 2, 6, 232, 161, 211, 127, 130, 243, 195, 167, 30,
        70, 1, 188, 224, 50, 84, 152, 107, 192, 21, 180, 237, 28, 114, 45, 187, 38, 122, 20, 254,
        202, 71, 245, 235, 178, 126, 211, 179, 176, 61, 10, 103, 34, 65, 197, 118, 5, 27, 150, 189,
        46, 60, 94, 185, 35, 207, 37, 209, 197, 84, 87, 106, 62, 27, 41, 116, 198, 235, 14, 90,
        222, 127, 26, 30, 171, 63, 255, 141, 41, 53, 206, 215, 237, 66, 117, 12, 27, 178, 142, 201,
        231, 67, 82, 137, 245, 78, 19, 88, 40, 84, 123, 79, 2, 191, 80, 218, 78, 125, 94, 231, 178,
        101, 121, 12, 31, 4, 17, 239,
    ],

    vk_ic: &[
        [
            26, 117, 81, 38, 33, 231, 103, 28, 33, 207, 192, 9, 40, 163, 239, 213, 143, 75, 215,
            83, 82, 99, 239, 43, 187, 29, 215, 94, 171, 232, 109, 97, 1, 34, 199, 15, 152, 146, 18,
            109, 191, 206, 154, 14, 65, 233, 113, 21, 117, 171, 39, 197, 154, 75, 176, 199, 151,
            75, 117, 63, 170, 66, 13, 98,
        ],
        [
            26, 34, 168, 154, 124, 160, 104, 241, 73, 142, 20, 231, 181, 8, 8, 182, 0, 225, 51,
            233, 173, 217, 93, 237, 166, 202, 87, 151, 55, 51, 87, 197, 43, 145, 207, 212, 5, 45,
            208, 198, 22, 238, 212, 232, 126, 17, 37, 125, 180, 176, 67, 75, 207, 58, 102, 122,
            182, 244, 89, 209, 133, 253, 4, 255,
        ],
    ],
};
